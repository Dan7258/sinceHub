<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профиль пользователя</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #fff;
            margin: 0;
            padding: 0;
            color: #333;
        }
        .container {
            max-width: 95%;
            margin: 50px auto;
            padding: 20px;
            padding-top: 80px;
            display: flex;
            gap: 20px;
            flex-direction: column;
        }
        .profile-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .profile-info img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #ccc;
        }
        .profile-details {
            display: flex;
            flex-direction: column;
        }
        .profile-details h2 {
            margin: 5px 0;
        }
        .profile-details p {
            margin: 5px 0;
            font-size: 0.9em;
        }
        .main-content {
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .main-content h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        .publication-list, .subscriptions-list {
            margin-bottom: 20px;
        }
        .publication-item, .subscription-item {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            background: #28a745;
            color: #fff;
            border-radius: 3px;
            text-decoration: none;
        }
        .publication-item:hover, .subscription-item:hover {
            background: #218838;
        }
        .subscription-item.unsubscribed {
            background: #007bff;
        }
        .subscription-item.unsubscribed:hover {
            background: #0056b3;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .action-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: #fff;
            font-size: 1em;
        }
        .action-buttons .subscribers-btn {
            background: #3498db;
        }
        .action-buttons .subscribers-btn:hover {
            background: #2980b9;
        }
        .action-buttons .subscriptions-btn {
            background: #9b59b6;
        }
        .action-buttons .subscriptions-btn:hover {
            background: #8e44ad;
        }
        .action-buttons .create-publication-btn {
            background: #28a745;
        }
        .action-buttons .create-publication-btn:hover {
            background: #218838;
        }
        .publication {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }
        .publication h3 {
            margin: 0 0 10px;
        }
        .publication p {
            margin: 5px 0;
        }
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .profile-info {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
    <script>
        // Оставляем скрипт без изменений
        document.addEventListener("DOMContentLoaded", function() {
            fetch('/getUserData', { credentials: 'include' })
                .then(response => {
                    if (response.status === 401) {
                        window.location.href = '/login';
                        document.querySelector('header').style.display = 'none';
                        return Promise.reject('Unauthorized');
                    }
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    document.querySelector('header').style.display = 'block';
                    document.getElementById('first_name').innerText = data.first_name || 'Не указано';
                    document.getElementById('last_name').innerText = data.last_name || 'Не указано';
                    document.getElementById('middle_name').innerText = data.middle_name || 'Не указано';
                    document.getElementById('country').innerText = data.country || 'Не указана';
                    document.getElementById('academic_degree').innerText = data.academic_degree || 'Не указана';
                    document.getElementById('appointment').innerText = data.appointment || 'Не указано';
                    document.getElementById('subscribers_count').innerText = data.SubscribersList?.length || 0;
                    document.getElementById('subscriptions_count').innerText = data.MySubscribesList?.length || 0;
                    const publicationsList = document.getElementById('publications');
                    publicationsList.innerHTML = '';
                    if (data.Publications && data.Publications.length > 0) {
                        data.Publications.forEach(pub => {
                            const div = document.createElement('div');
                            div.className = 'publication';
                            div.innerHTML = `
                                <h3>${pub.title || 'Без названия'}</h3>
                                <p><strong>Аннотация:</strong> ${pub.abstract || 'Нет аннотации'}</p>
                                <p><strong>Содержание:</strong> ${pub.content || 'Нет содержания'}</p>
                                <p><strong>Создано:</strong> ${new Date(pub.created_at).toLocaleDateString()}</p>
                                <p><strong>Обновлено:</strong> ${new Date(pub.updated_at).toLocaleDateString()}</p>
                            `;
                            publicationsList.appendChild(div);
                        });
                    } else {
                        publicationsList.innerHTML = 'Публикаций нет';
                    }
                    const subscribersList = document.getElementById('subscribers_list');
                    subscribersList.innerHTML = '';
                    if (data.SubscribersList && data.SubscribersList.length > 0) {
                        data.SubscribersList.forEach(sub => {
                            const a = document.createElement('a');
                            a.className = 'subscription-item';
                            a.href = '#';
                            a.innerText = `${sub.first_name} ${sub.last_name}`.trim() || 'Неизвестный';
                            subscribersList.appendChild(a);
                        });
                    } else {
                        subscribersList.innerHTML = 'Подписчиков нет';
                    }
                    const mySubscribesList = document.getElementById('my_subscribes_list');
                    mySubscribesList.innerHTML = '';
                    if (data.MySubscribesList && data.MySubscribesList.length > 0) {
                        data.MySubscribesList.forEach(sub => {
                            const a = document.createElement('a');
                            a.className = 'subscription-item unsubscribed';
                            a.href = '#';
                            a.innerText = `${sub.first_name} ${sub.last_name}`.trim() || 'Неизвестный';
                            mySubscribesList.appendChild(a);
                        });
                    } else {
                        mySubscribesList.innerHTML = 'Подписок нет';
                    }
                })
                .catch(error => {
                    console.error('Ошибка при получении профиля:', error);
                    document.querySelector('.container').innerHTML =
                        '<p style="color: #e74c3c;">Ошибка при загрузке профиля</p>';
                });

            document.getElementById('subscribers_btn').addEventListener('click', function() {
                document.getElementById('subscribers_list').scrollIntoView({ behavior: 'smooth' });
            });
            document.getElementById('subscriptions_btn').addEventListener('click', function() {
                document.getElementById('my_subscribes_list').scrollIntoView({ behavior: 'smooth' });
            });
            document.getElementById('create_publication_btn').addEventListener('click', function() {
                window.location.href = '/createPublication';
            });
        });
    </script>
</head>
<body>
{{template "header.html"}}
<div class="container">
    <div class="profile-info">
        <img src="https://via.placeholder.com/100" alt="Аватар">
        <div class="profile-details">
            <h2 id="first_name"></h2>
            <h2 id="last_name"></h2>
            <h2 id="middle_name"></h2>
            <p>Ученая степень: <span id="academic_degree"></span></p>
            <p>Должность: <span id="appointment"></span></p>
            <p>Страна: <span id="country"></span></p>
            <p>Подписчики: <span id="subscribers_count"></span></p>
            <p>Подписки: <span id="subscriptions_count"></span></p>
        </div>
    </div>
    <div class="action-buttons">
        <button id="subscribers_btn" class="subscribers-btn">Подписчики</button>
        <button id="subscriptions_btn" class="subscriptions-btn">Мои подписки</button>
        <button id="create_publication_btn" class="create-publication-btn">Создать публикацию</button>
    </div>
    <div class="main-content">
        <h2>Последние публикации</h2>
        <div class="publication-list" id="publications">
            Загрузка...
        </div>
        <h2>Список подписчиков</h2>
        <div class="subscriptions-list" id="subscribers_list">
            Загрузка...
        </div>
        <h2>Список подписок</h2>
        <div class="subscriptions-list" id="my_subscribes_list">
            Загрузка...
        </div>
    </div>
</div>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'923dc6de589e12ee',t:'MTc0MjU2MzU0Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>